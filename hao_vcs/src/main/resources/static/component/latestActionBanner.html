<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>状态更新栏</title>
    <script src="../js/outService.js"></script>
    <script src="../js/fileInProject.js"></script>
</head>
<body>
<div id="app">
    <el-card class="project-card">
        <div slot="header">
            <span>{{latestChangeImf.latestActor}}</span>
            <span style="color: #8db2f6; margin-left: 1%;">{{latestChangeImf.latestAction}}</span>
            <span style="font-size: small;margin-left: 1%;color: #8c939d">
                            {{latestChangeImf.latestUpdateTime}}</span>
        </div>
        <div>
            <el-card class="box-card">
                <div v-for="file in showList" :key="file" class="text item">
                    {{file}}
                </div>
            </el-card>
            <el-pagination
                    layout="prev, pager, next"
                    :total="fileNum"
                    :hide-on-single-page=true
                    :page-size="pageSize"
                    @current-change="handleCurrentChange">
            </el-pagination>
        </div>
    </el-card>

</div>
<script>
    var vm = new Vue({
        el: "#app",
        data() {
            return {
                projectId: '',
                latestChangeImf: {latestActor: "cyh?", latestAction: "nothing?", latestUpdateTime: "now?"},
                allNum: 0,
                dirNum: 0,
                fileNum: 9,
                dirList: {},
                fileList: {},
                allList:{},
                startIndex: 0,
                endIndex: 10,
                currentPage: 1, //初始页
                pageSize: 8,
                showList:{}
            }
        },
        mounted() {
            this.projectId = window.location.search.split("?")[1]
            this.getLatestProjectChangeImf()
            this.getProjectContent(this.projectId)
        },
        methods: {
            getProjectContent(projectId) {
                axios.get('/project/getProjectContent', {params: {projectId: projectId}})
                    .then(results => {
                        if (results.data.code === 20000) {
                            let allContent = results.data.data
                            this.dirList = allContent.dir
                            this.fileList = allContent.file
                            this.dirNum = this.dirList.length
                            this.fileNum = this.fileList.length
                            this.allNum = this.dirNum + this.fileNum
                            this.allList = [this.dirList, ...this.fileList]
                            console.log(allContent)
                            console.log(this.dirList)
                            console.log(this.fileNum)
                            console.log(this.allList)
                            this.handleCurrentChange(1)
                        } else {
                            return null;
                        }
                    })
            },
            getIcon() {
                if(this.currentPage * this.pageSize <= this.dirNum){
                    return 0
                }
                return 1
            },
            getLatestProjectChangeImf() {
                axios.get('/project/changeImf', {params: {'projectId': this.projectId}})
                    .then(results => {
                        if (results.data.code === 20000) {
                            this.latestChangeImf = results.data.data
                        } else {
                            this.$message.warning("工程更新信息异常")
                            this.showProjectList = false
                        }
                    })
            },
            handleCurrentChange (currentPage) {
                this.currentPage = currentPage;
                this.showList = this.allList.slice((this.currentPage - 1) * this.pageSize, this.currentPage * this.pageSize)
                console.log('点击'+this.currentPage);
                console.log(this.showList)
            },
        }
    })
</script>
</body>
</html>