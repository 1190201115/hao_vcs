<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文本编辑器</title>
    <script src="../js/outService.js"></script>
    <script src="../ckeditor/ckeditor.js"></script>
</head>
<body >
<div id="fatherEditor">
    <div v-show = "showTextEditor">
        <textarea id="textEditor">
        </textarea>
    </div>

</div>
<script>
    var vm = new Vue({
        el: "#fatherEditor",
        data() {
            return {
                editor: null,
                text: 'if you see this, please refresh',
                projectId: '',
                path: '',
                showTextEditor: false,
            }
        },
        mounted() {
            this.projectId = window.location.search.split("?")[1]
            this.path = decodeURI(window.location.search.split("?")[2].replaceAll('/','\\'))
            this.getContent(this.projectId, this.path)
        },
        methods: {
            getContent(projectId, path) {
                console.log(path)
                axios.get('/project/getFileContent', {params: {projectId: projectId, morePath: path}})
                    .then(results => {
                        console.log(results)
                        if (results.data.code === 20000) {
                            let msg = results.data.msg
                            let data = results.data.data
                            console.log(msg)
                            if(msg === 'text'){
                                console.log('in')
                                this.initCKEditor()
                                CKEDITOR.instances.textEditor.setData(data)
                                this.showTextEditor = true
                            }
                        } else {
                            this.$message.error(results.data.data)
                        }
                    })
            },
            initCKEditor() {
                this.editor = CKEDITOR.replace('textEditor', {
                    uiColor: '#3a9edc',
                    width: '100%',
                    height: screen.height * 0.77,
                    toolbar: [
                        ['Source', 'Save', 'Preview'],
                        ['Find', 'Scayt'],
                        ['Bold', 'Italic', 'Underline', 'Blockquote', '-', 'Link', 'Unlink', '-', 'Image', 'Smiley', 'oembed']
                    ]
                });
                CKEDITOR.plugins.registered['save'] =
                    {
                        init : function( editor )
                        {
                            editor.addCommand( 'save',
                                {
                                    modes : { wysiwyg:1, source:1 },
                                    exec : function( editor ) {
                                        let content =editor.getData();
                                        axios.post('/text/doc', {fileName: 'test.doc', content: content}).then(results => {
                                            alert(results.data.msg)
                                        })
                                    }
                                }
                            );
                            editor.ui.addButton( 'Save', {label : '保存', command : 'save'} );
                        }
                    }
            },


        }
    })
</script>
</body>
</html>